# プロダクトレビュー会議書類

**作成日:** 2026-01-29
**目的:** 自主製作レベルから外部公開可能なプロダクトへの昇華
**対象:** RigLab v1.0 リリース前検証

**主人の記入方法:**上から3.2 管理者向け画面（✅ 実装完了）まで手書きで記入済み
**主人の評価方法:**[○][×][▲]の3つで評価した。[○]は「はい」、[×]は「いいえ」、[▲]は「どちらともいえない」

---

## 1. 現状サマリー

| 項目 | 状態 |
|------|------|
| バックエンド | ✅ 100% 完了（モデル、API、サービス、管理者API） |
| フロントエンド | ✅ 100% 完了（ユーザー向け画面、管理者画面） |
| 認証 | ✅ NextAuth.js + JWT 統合完了 |
| ドキュメント | ✅ 全11種完了 |
| テスト | ✅ モデル/API/サービス/E2Eテスト完了 |

**Phase 0〜5 基本機能実装: 100% 完了**

> 詳細は `docs/02_deliverables.md` 参照（91成果物）

---

## 2. 設計仕様 vs 実装 突合チェックリスト

### 2.1 コア機能（要件定義書 FR-001〜005）

| ID | 機能 | 設計仕様 | 実装状況 | 確認 | 備考 |
|----|------|----------|----------|------|------|
| FR-001 | おまかせ構成提案 | 予算・用途から最適構成を提案 | [○] 確認済 | [▲] | プリセット取得は要検証（BUG-01参照）。カスタム側の自動推奨は✅修正済 |
| FR-002 | カスタム構成作成 | パーツ選択、互換性チェック、自動推奨 | [○] 確認済 | [○] | ✅ 自動推奨パーツ修正済（Phase 6）。互換性チェックは要検証 |
| FR-003 | 構成保存・管理 | ログインユーザーのみ保存・編集・削除 | [○] 確認済 | [○] | 構成保存編集削除はできてる|
| FR-004 | 構成共有 | URLエンコード＋OG画像生成 | [○] 確認済 | [x] | share_token 動作確認要 ←それっぽいUIは出てる。リンクをコピーとかもできる。ディスコードの自分だけのグループに貼ってみて検証したがPCの構成がパット見で分かるような画像の添付はなかった。多分できてない。これ上の構成取得がうまくできてないのと関係ありそうじゃない？ |
| FR-005 | ユーザー認証 | Credentials認証、JWT検証 | [○] 確認済 | [▲] | NextAuth.js + Rails JWT連携 ユーザー認証とかはできてるけどセキュリティ的にこれ大丈夫か？感はある。あんまり面倒にするとテストが面倒になるので最後の最後でいいが、セキュリティはちゃんと見直したほうがよさそう |

**確認質問:**
- [x] おまかせ構成の推奨ロジックは期待通り動作しているか？：✅ カスタム構成の自動推奨はPhase 6で修正済。おまかせ構成（preset）は別途確認要
- [x] 互換性チェックは全パターン（CPU/メモリ/マザーボード/GPU/ケース）網羅しているか？：✅ APIでカテゴリ固有情報（socket, tdp, memory_type等）が返るよう修正済。互換性チェックロジック自体は要検証
- [x] OG画像は正しく生成・表示されるか？：表示されてない。リンクは共有できるけど画像あったほうがいいよなと思う。

---

### 2.2 管理者機能（要件定義書 FR-101〜103）

| ID | 機能 | 設計仕様 | 実装状況 | 確認 | 備考 |
|----|------|----------|----------|------|------|
| FR-101 | パーツ管理 | CRUD（管理者のみ） | ✅ API + UI 完了 | [○] | 8カテゴリ対応 |
| FR-102 | おまかせ構成管理 | テンプレートCRUD | ✅ API + UI 完了 | [○] | パーツ選択UI |
| FR-103 | ユーザー管理 | 一覧表示、権限管理 | ✅ API実装済み | [○] | API完了（GET/PATCH /api/v1/admin/users）。フロントエンドUI（/admin/users）も実装済み |

---

### 2.3 非機能要件チェック

| ID | 要件 | 設計仕様 | 確認 | 現状/課題 |
|----|------|----------|------|-----------|
| NFR-001 | デバイス対応 | PC/スマホ/タブレット | [○] | 実機テスト要←確認できたけどハンバーガーメニューが機能してない。押しても反応しない |
| NFR-002 | レスポンシブ | モバイルファースト | [○] | ブレークポイント確認要←レスポンシブに動いてると思う。ブレークポイントはよくわからない |
| NFR-003 | レスポンス時間 | ページ3秒/API 500ms以内 | [×] | パフォーマンス計測未実施←測り方わからぬ |
| NFR-004 | 認証・認可 | JWT、パスワード要件、ログイン制限 | [×] | ログイン試行制限は実装済？←未確認 |
| NFR-005 | 通信セキュリティ | HTTPS、CORS、CSP | [×] | 本番環境設定確認要←これもわからない。CORSとか設定した覚えあるけどHTTPSとCSPはわからない |
| NFR-006 | データ保護 | bcrypt、SQLi/XSS/CSRF対策 | [×] |わからん、このへんやってないと思う。やってほしい|
| NFR-007 | 権限管理 | ゲスト/ユーザー/管理者の3ロール | [x] | ✅ role カラム確認済。確認コマンド: `docker compose exec back bundle exec rails c` → `User.pluck(:email, :role)` |

---

## 3. 画面フロー検証

### 3.1 ユーザー向け画面

| 画面 | URL | 設計通り? | UX課題 | 備考 |
|------|-----|-----------|--------|------|
| [○] トップページ | `/` | [▲] | | |
| [○] おまかせ構成 | `/builder` | [○] | | 予算・用途選択UI |
| [○] おまかせ結果 | `/builder/result` | [×] | | 結果0件時のEmpty State←そもそも「エラーが発生しました
申し訳ありません。予期しないエラーが発生しました。
再度お試しください。」って出てるし0件表示出なさそう、要確認 |
| [○] カスタム構成 | `/configurator` | [○] | | ✅ 自動推奨パーツ修正済（Phase 6） |
| [○] 構成詳細 | `/builds/[id]` | [○] | | ✅ 推奨パーツ表示修正済（Phase 6）。編集/共有ボタンは画像出力を除き機能 |
| [○] ダッシュボード | `/dashboard` | [○] | | 構成0件時のEmpty State |
| [○] ログイン | `/signin` | [○] | | エラー表示 |
| [○] 新規登録 | `/signup` | [○] | | バリデーション |
| [×] 共有構成 | `/share` | [×] | | OG画像プレビュー←画像のプレビューがそもそもない。/shareってページはない。まぁ共有はできるが、画像あったほうがいいとおもう。 |

**確認質問:**
- [×] 各画面のローディング状態は適切か？：確認できてない。確認作業としては重いので正直やってほしさはある
- [×] エラー状態（API失敗等）のハンドリングは十分か？：確認できてない。確認作業としては重いので正直やってほしさはある
- [▲] キーボードナビゲーションは動作するか？：スペースは動くよ、何押したらどう動くかの設定は知らない

---

### 3.2 管理者向け画面（✅ 実装完了）

| 画面 | URL | 実装状況 | 確認 | 備考 |
|------|-----|----------|------|------|
| 管理ダッシュボード | `/admin` | ✅ 完了 | [○] | 統計表示・クイックアクション |
| パーツ一覧 | `/admin/parts` | ✅ 完了 | [○] | カテゴリフィルター・ページネーション |
| パーツ新規登録 | `/admin/parts/new` | ✅ 完了 | [○] | 8カテゴリ対応フォーム |
| パーツ編集 | `/admin/parts/[id]` | ✅ 完了 | [○] | ✅ カテゴリ固有情報（socket, tdp等）はAPIで返却されるよう修正済 |
| プリセット一覧 | `/admin/presets` | ✅ 完了 | [○] | 予算帯・用途フィルター |
| プリセット新規 | `/admin/presets/new` | ✅ 完了 | [○] | パーツ選択UI |
| プリセット編集 | `/admin/presets/[id]` | ✅ 完了 | [○] | |

---

## 4. APIエンドポイント検証

### 4.1 認証API

| エンドポイント | メソッド | 動作確認 | 備考 |
|---------------|---------|----------|------|
| [x] `/api/v1/auth/register` | POST | [x] | ユーザー登録（実装済み） |
| [x] `/api/v1/auth/login` | POST | [x] | ログイン（実装済み） |
| [x] `/api/v1/auth/sign_out` | DELETE | [x] | ログアウト（✅ 6-J-1で実装済み） |
| [x] `/api/v1/auth/me` | GET | [x] | トークン検証（validate_token の代替として実装済み） |

**注記:** 設計仕様と実装のエンドポイント名が異なる（register/login形式で実装）。sign_out は 6-J-1 で実装済み。

### 4.2 パーツAPI

| エンドポイント | メソッド | 動作確認 | 備考 |
|---------------|---------|----------|------|
| [x] `/api/v1/parts` | GET | [x] | ✅ フィルタリング動作確認済・テスト完備 |
| [x] `/api/v1/parts/:id` | GET | [x] | ✅ カテゴリ固有情報も返却（Phase 6修正済） |
| [x] `/api/v1/parts/recommendations` | GET | [x] | ✅ 自動推奨パーツ（Phase 6実装） |

### 4.3 プリセットAPI

| エンドポイント | メソッド | 動作確認 | 備考 |
|---------------|---------|----------|------|
| [x] `/api/v1/presets` | GET | [x] | ✅ budget/use_case検索動作確認済・テスト完備 |
| [x] `/api/v1/presets/:id` | GET | [x] | ✅ 実装済み・テスト完備 |

### 4.4 構成API

| エンドポイント | メソッド | 動作確認 | 備考 |
|---------------|---------|----------|------|
| [x] `/api/v1/builds` | GET | [x] | ✅ 要認証・テスト完備 |
| [x] `/api/v1/builds/:id` | GET | [x] | ✅ 共有時は認証不要・テスト完備 |
| [x] `/api/v1/builds` | POST | [x] | ✅ 要認証・推奨パーツIDも保存（Phase 6修正済）・テスト完備 |
| [x] `/api/v1/builds/:id` | PATCH | [x] | ✅ 要認証、所有者のみ・テスト完備 |
| [x] `/api/v1/builds/:id` | DELETE | [x] | ✅ 要認証、所有者のみ・テスト完備 |
| [x] `/api/v1/share_tokens` | POST | [x] | ✅ 共有トークン生成（share_token方式で実装）・テスト完備 |

### 4.5 管理者API

| エンドポイント | メソッド | 動作確認 | 備考 |
|---------------|---------|----------|------|
| [x] `/api/v1/admin/parts` | POST | [x] | ✅ 要Admin権限・テスト完備 |
| [x] `/api/v1/admin/parts/:id` | PATCH | [x] | ✅ テスト完備 |
| [x] `/api/v1/admin/parts/:id` | DELETE | [x] | ✅ テスト完備 |
| [x] `/api/v1/admin/presets` | POST | [x] | ✅ テスト完備 |
| [x] `/api/v1/admin/presets/:id` | PATCH | [x] | ✅ テスト完備 |
| [x] `/api/v1/admin/presets/:id` | DELETE | [x] | ✅ テスト完備 |
| [x] `/api/v1/admin/users` | GET | [x] | ✅ ユーザー一覧・テスト完備 |
| [x] `/api/v1/admin/users/:id` | PATCH | [x] | ✅ 権限管理（role変更）・テスト完備 |

---

## 5. プロダクト品質向上のための検討事項

### 5.1 セキュリティ

| 項目 | 現状 | 対応要否 | 優先度 |
|------|------|----------|--------|
| [x] ログイン試行制限（5回失敗で15分ロック） | ✅ Rack::Attack 実装済み（6-J-2） | - | - |
| [x] パスワード要件（8文字以上、英数字混合） | ✅ 実装済み | - | - |
| [x] CSRF対策 | ✅ Rails標準で確認済 | - | - |
| [x] XSS対策 | ✅ React標準で確認済 | - | - |
| [x] SQLインジェクション対策 | ✅ ActiveRecordで確認済 | - | - |
| [x] レート制限（API） | ✅ Rack::Attack 実装済み（6-J-2） | - | - |
| [x] セキュリティヘッダー（CSP等） | ✅ CSP設定済み（6-J-2） | - | - |
| [x] CORS設定 | ✅ 実装済み（production.rb確認済） | - | - |

**質問:**
- 本番環境での HTTPS 設定は完了予定か？
- 環境変数（シークレット）の管理方針は？

---

### 5.2 パフォーマンス

| 項目 | 現状 | 対応要否 | 優先度 |
|------|------|----------|--------|
| [x] 初回ロード時間 | ✅ ビルド成功、全ページ問題なし（Plans.md PERF-01参照） | - | - |
| [x] APIレスポンス時間 | ✅ Plans.md PERF-02参照（parts 320ms / presets 227ms / builds 49ms） | - | - |
| [x] 画像最適化 | ✅ OG画像1200x630標準サイズ、静的画像なし（next/image不使用） | - | - |
| [x] バンドルサイズ | ✅ 最小限の依存関係（5 production deps）確認済み | - | - |
| [x] DBインデックス | ✅ schema.rb で全主要カラムにインデックス確認済み | - | - |

---

### 5.3 UX/アクセシビリティ

| 項目 | 現状 | 対応要否 | 優先度 |
|------|------|----------|--------|
| [x] 見出し階層（h1〜h3） | ✅ h1統一、h2/h3順序修正済み（Phase 6） | - | - |
| [x] aria-label（アイコンボタン） | ✅ dashboard、admin各ページのSVG/ボタン修正済み（Phase 6） | - | - |
| [x] フォーカスリング | ✅ Button/Input/Select に focus-visible:ring 確認済み（Phase 6） | - | - |
| [x] キーボード操作 | ✅ Modal に Escape/role="dialog"/aria-modal 確認済み（Phase 6） | - | - |
| [x] エラーメッセージの明確さ | ✅ role="alert" を Input/Select/signin/signup/configurator に追加（Phase 6） | - | - |
| [x] 色のコントラスト | ✅ 主要テキスト色確認済み（gray-400はdisabled/装飾のみ、重要テキストは問題なし） | - | - |
| [ ] スクリーンリーダー対応 | 未確認 | [ ] 要確認 | 低 |

---

### 5.4 運用・保守

| 項目 | 現状 | 対応要否 | 優先度 |
|------|------|----------|--------|
| [x] エラー監視（Sentry） | ✅ @sentry/nextjs + sentry-rails 導入済み（DSN未設定時no-op） | - | - |
| [x] ログ出力 | ✅ production.rb で stdout出力、TaggedLogging、ENV変数でレベル制御 | - | - |
| [x] バックアップ戦略 | ✅ docs/08にDB定期バックアップ・復元手順追記済み | - | - |
| [x] デプロイ手順 | ✅ docs/08をNext.js向けに最新化済み | - | - |
| [x] 環境分離（dev/staging/prod） | ✅ .env.example整理、CORS ENV変数化、docs/08にチェックリスト追記 | - | - |

---

## 6. v1.0 リリース前 必須タスク

### 6.1 必須（ブロッカー）

- [x] **管理者画面UI実装** - ✅ 完了（PR #22）
- [x] **シードデータ投入** - ✅ 6-D で実装済み（9プリセット + パーツデータ）
- [x] **E2Eテスト（管理画面）** - ✅ 完了（frontend/e2e/admin.spec.ts）
- [x] **E2Eテスト（ユーザーフロー）** - ✅ 6-J-3 で実装済み（おまかせ/カスタム/保存・共有フロー）
- [x] **セキュリティ設定確認** - ✅ 6-J-2 で対応済み（Rack::Attack、CSP、環境変数管理確認）

### 6.2 推奨（品質向上）

- [x] パフォーマンス計測・改善 ← ✅ Plans.md PERF-01〜04 全クリア
- [x] アクセシビリティ監査（Lighthouse等）← ✅ Plans.md TEST-04 全基準クリア
- [x] エラー監視導入 ← ✅ Sentry（@sentry/nextjs + sentry-rails）DSN未設定時no-op
- [x] レスポンシブ実機テスト ← ✅ Plans.md TEST-02 30項目実施

### 6.3 将来課題（v1.1以降）

- [x] NextAuth.js v4 → v5 アップグレード ← ✅ Auth.js v5 移行完了
- [x] ユーザー管理画面（FR-103） → ✅ API + フロントエンドUI 実装済み
- [x] OG画像の表示問題 → ✅ Phase 6-E で修正済み
- [x] ダークモード → ✅ Phase 9 で実装済み（next-themes + daisyUI テーマ切替）
- [ ] PWA対応
- [ ] 多言語対応

#### API活用（Phase 7〜8.5 — 実装完了）

**方針:** スクレイピング不採用（利用規約違反・著作権リスク）、公式API活用で合法的に実装
**理由:** パーツの手入力が非現実的なため、API自動取得をリリース前に組み込む

| API | 用途 | 状態 |
|-----|------|------|
| ~~Amazon PA-API~~ | ~~パーツ情報・価格の自動取得~~ | 見送り（下記参照） |
| 楽天商品検索API | 商品検索・ランキング・価格比較 | ✅ Phase 7〜8.5で実装済み |
| （独自集計） | 価格推移グラフ・買い時判定 | ✅ Phase 7〜8で実装済み |

**Amazon PA-API見送り理由:**
- PA-APIはAmazonアソシエイト売上実績が前提（新規は1req/s制限）
- サイト主目的がAmazon販売誘導でないとToS違反リスク
- 楽天APIは無料枠が充実、アプリID取得が容易、PCパーツカテゴリ対応良好
- → 楽天商品検索APIを採用（Phase 8.5で実装済み）

**実装済み機能:**
- 楽天商品検索API連携（管理画面からのパーツ検索・インポート）
- 楽天ランキングAPI連携（PCパーツ7カテゴリのランキング表示）
- 価格推移グラフの表示（Rechartsによる価格動向チャート）
- 「PC買い時おじさん」の一言コメント（価格トレンドに基づくアドバイス表示）
- TOPページへの買い時情報・人気パーツ・価格動向セクション掲載

---

## 7. 議論ポイント

以下の点について、認識を合わせたい：

### 7.1 スコープ確認

1. **v1.0のゴールは何か？**
   - [ ] 個人利用レベル（自分が使える）
   - [ ] 外部公開レベル（他人に見せられる）
   - [x] プロダクトレベル（課金・集客を見据える）

2. **管理者画面の必要性**
   - [x] v1.0で必須 → ✅ 実装完了
   - [ ] ~~シードデータで代用し、v1.1で対応~~

3. **テストカバレッジ目標**
   - [ ] 主要フローのE2Eのみ
   - [×] ユニットテスト80%以上
   - [ ] 現状のままでOK

---

### 7.2 技術的判断

1. **認証方式**
   - 現状: NextAuth.js (v4) + Rails JWT検証
   - 質問: この構成で問題ないか？v5移行の優先度は？

2. **デプロイ先**
   - 想定: Vercel (Frontend) + Render/Railway (Backend)?
   - 質問: インフラ構成は確定しているか？

3. **DB運用**
   - 想定: PlanetScale / Neon / RDS?
   - 質問: データバックアップ・復旧の方針は？

---

### 7.3 ビジネス判断（該当する場合）

1. **利用規約・プライバシーポリシー**
   - [ ] 作成済み
   - [ ] 作成予定
   - [ ] 不要（個人利用のため）

2. **分析・トラッキング**
   - [ ] Google Analytics導入予定
   - [ ] 不要

---

## 8. 次のアクション

会議で以下を決定する：

1. [ ] v1.0 スコープの最終確定
2. [ ] 管理者画面実装の優先度確定
3. [ ] セキュリティ・インフラの確認担当
4. [ ] リリーススケジュール（目標日）

---

---

## 9. レビューで発見した課題・要望

### 9.1 バグ・不具合（要修正）

| # | 内容 | 優先度 | 備考 |
|---|------|--------|------|
| BUG-01 | ~~おまかせ構成で条件指定なしで検索すると `Cannot read properties of undefined (reading 'name')` エラー~~ | ✅ 修正済 | Phase 6-B で修正済み（nullセーフなPartRow実装 + シリアライズ修正） |
| BUG-02 | ~~自動推奨パーツが機能していない~~ | ✅ 修正済 | Phase 6で `/parts/recommendations` エンドポイント実装、保存時に推奨パーツIDも保存するよう修正 |
| BUG-03 | ~~ハンバーガーメニューが無反応~~ | ✅ 修正済 | Phase 6-B で修正済み（モバイルメニュー開閉機能を実装） |
| BUG-05 | おまかせ構成結果で構成名が表示されない | 中 | `builder/result/page.tsx:150` で `おすすめ構成 #1` のようにインクリメント番号を表示しており、プリセットの実際の `name` が使われていない。`preset.name` を表示すべき |

### 9.2 仕様の誤り

| # | 内容 | 正しい仕様 | 備考 |
|---|------|-----------|------|
| SPEC-01 | ~~プリセット新規登録の価格帯「ミドル」が10〜20万~~ | ✅ 修正済 | 10〜30万に修正（Phase 6） |

### 9.3 UX改善要望

| # | 内容 | 優先度 | 解決案 |
|---|------|--------|--------|
| UX-01 | ページネーションが下だけで億劫 | 中 | 上下両方に設置 or 無限スクロール or 「トップへ戻る」ボタン |
| UX-02 | マザボとCPUの互換性がわからない | 高 | CPUを選ぶと対応マザボを絞り込み表示 |
| UX-03 | 選択肢から予算と相談して構成を導き出したい | 高 | ステップ式UI（CPU→マザボ→電源→ケース） |
| UX-04 | 構成カードそのものをリンクにしたい | 中 | 詳細ボタンではなくカード全体クリックで遷移 |
| UX-05 | カスタム構成のUIを順序立てたい | 高 | CPU選択→対応マザボ表示→電源/ケース自動絞り込み |
| UX-06 | 構成保存時の通知が `alert()` で安っぽい | 中 | トースト通知やインラインメッセージ等、モダンなフィードバックUIに置き換えたい（builder/result、configurator両方） |
| UX-07 | 管理画面でパーツ/プリセット登録後のフィードバックがない | 中 | 登録・更新成功時にトースト通知をふわっと表示して「登録できた」安心感を与える（admin/parts、admin/presets） |
| UX-08 | パーツ管理でカテゴリ絞り込み後、編集→キャンセル/戻るで絞り込みがリセットされる | 中 | フィルタ状態をURLクエリパラメータやsessionStorageで保持し、戻った時に復元する（admin/parts） |
| UX-09 | 管理画面のプリセット編集でパーツ選択時に合計金額が見えない | 中 | カスタム構成画面のように選択パーツの合計額をリアルタイム表示する（admin/presets/new、admin/presets/[id]） |
| UX-10 | スマホのハンバーガーメニューでアカウント名が下の方にある | 中 | ログイン中のアカウント名をメニュー最上部に表示する（現状: Builder→Configurator→管理者→Dashboard→ログアウトの順） |
| UX-11 | 縦に長いページに「先頭に戻る」ボタンがない | 中 | 管理画面で実装済みの「トップへ戻る」ボタンと同じものを、おまかせ構成結果（/builder/result）やダッシュボード等、リストが伸びるユーザー向けページにも共通で設置する |
| UX-12 | /builder と /builder/result でコンテンツの左右幅が異なる | 低 | ページごとに適切なコンテナ幅を決めて統一する（全体共通ではなく、各ページの用途に合わせて個別に設定） |
| UX-13 | 詳細・編集ページから元の一覧に戻るボタンがない | 中 | 構成詳細（/builds/[id]）、構成編集（/configurator?edit=）、管理画面の各編集ページ（admin/parts/[id]、admin/presets/[id]）に「戻る」ボタンを追加し、元の一覧ページへ遷移できるようにする |
| UX-14 | 管理画面のバリデーションエラーが英語のまま | 中 | Rails側のエラーメッセージを日本語化する（例: "Form factor can't be blank" → "フォームファクタを入力してください"）。rails-i18nのja.ymlで対応 |
| UX-15 | プリセットの合計金額が選択した予算帯に収まっていなくても登録できてしまう | 中 | プリセット登録・編集時にパーツ合計額が予算帯の範囲外の場合、警告を表示して確認を取る（保存はブロックせず警告のみ） |

### 9.4 新機能要望

| # | 内容 | 優先度 | 備考 |
|---|------|--------|------|
| FEAT-01 | 価格.com / Amazon API連携 | 高 | パーツ価格・情報の自動取得、価格変動対応 |
| FEAT-02 | プリセットのシードデータ | 高 | 手入力の手間を省く |
| FEAT-03 | パーツ互換性を関数的・弄りやすい形で実装 | 中 | 設定ファイルやDBベースで管理？ |
| FEAT-04 | ダークモード対応 | 中 | 目に優しい、ユーザー選択可能に |

### 9.5 ターゲットユーザーの明確化

> **対象:** 主要パーツ（CPU、マザボ、グラボ、メモリ）の名前は分かるが、
> ケースサイズや電源などの細かい部分は分からない「浅めのPCゲーマー」

**このユーザーが求めること:**
- 「このCPUを選んだら、どのマザボが合うの？」に答える
- 予算に合わせて選択肢を絞り込んでくれる
- 難しい互換性は自動で解決してくれる
- 最終的に「これでいいんだ」と安心できる

---

## 10. 対応方針（要議論）

### 10.1 現状の課題一覧（優先度順）

**高優先度（v1.0ブロッカー）:**
- [x] BUG-01: おまかせ構成の空検索エラー修正 ✅ Phase 6-B で修正済み
- [x] BUG-03: ハンバーガーメニュー無反応 ✅ Phase 6-B で修正済み
- [x] OG画像が表示されない ✅ Phase 6-E で修正済み

**中優先度（品質向上）:**
- [x] 認証APIの欠落: sign_out エンドポイント ✅ 6-J-1 で実装済み
- [x] セキュリティ: ログイン試行制限、レート制限 ✅ 6-J-2 Rack::Attack で実装済み
- [x] セキュリティヘッダー: CSP ✅ 6-J-2 で設定済み
- [x] UX-02/UX-05: CPU→マザボ→電源→ケースの順序立てUI ✅ 6-C で互換性フィルタリング実装済み
- [ ] UX-01: ページネーション上部追加（「トップへ戻る」ボタンは実装済み）

**低優先度（v1.1以降）:**
- [ ] パフォーマンス計測（手動テスト手順書で手順化済み）
- [ ] アクセシビリティ監査（Lighthouse等）（手動テスト手順書で手順化済み）
- [ ] NextAuth v5 アップグレード
- [ ] FEAT-04: ダークモード
- [ ] デザイン一新

**完了済み:**
- [x] BUG-02: 自動推奨パーツ機能の修正 ✅ Phase 6完了
- [x] SPEC-01: 価格帯ミドルの修正（10〜30万） ✅ Phase 6完了
- [x] FR-103: ユーザー管理API + フロントエンドUI ✅ 実装済み

### 10.2 ページネーションの代替案

| 案 | メリット | デメリット |
|----|----------|-----------|
| 上下両方に設置 | シンプル、実装簡単 | 画面が少し煩雑 |
| 無限スクロール | モダン、スムーズ | 「何ページ目」が分からない、SEO難 |
| 「トップへ戻る」ボタン | 実装簡単 | ページ切替時に上に戻る手間 |
| ヘッダー固定+ページネーション | 常に見える | スクロール時の画面圧迫 |

**推奨:** 上下両方に設置（シンプルで確実）

### 10.3 互換性管理の設計案

```
# 例: 互換性定義ファイル（YAML/JSON）
cpu_socket_compatibility:
  LGA1700:
    - Z790
    - B760
    - H770
  AM5:
    - X670E
    - X670
    - B650E
    - B650

memory_type_compatibility:
  DDR5:
    - Z790
    - B760
    - X670E
  DDR4:
    - B660
    - H610
```

- 関数的に呼び出せる形で実装
- DBに持つ or 設定ファイルで管理
- 新パーツ追加時も簡単に対応可能

---

## 11. 意思決定記録

### 11.1 2026-01-31 Phase 6 キックオフ会議

**確定事項:**

1. **プロダクトの本質（再確認）**
   - ターゲットユーザー: CPU/GPU/メモリは分かるが、電源・マザボ・ケースの互換性が分からない「浅めのPCゲーマー」
   - コア機能: 「推奨」ではなく「選ばせる」。互換性のある選択肢をフィルタリング表示し、ユーザーが予算と相談して自分で選ぶ

2. **バグ認識の訂正**
   - 当初BUG-01としていた「構成を編集」ボタン無反応 → **勘違い**（バグではない）
   - 当初SPEC-01としていたダッシュボード「おまかせ構成を試す」が / に遷移 → **バグではない**
   - **本当のバグ**: ハンバーガーメニュー無反応（BUG-03として追加）

3. **プリセットSeedデータの予算帯**: 10万円 / 25万円 / 40万円 の3種類（4種類ではない）

4. **UI設計方針**
   - 1画面のまま、選択順に絞り込み（画面遷移なし）
   - ステップナビゲーション不要
   - 互換性フィルタリング実装

5. **優先度**
   - 認証系セキュリティ: 後回し（テスト時に面倒になるため）
   - RSpecテストレビュー: 高優先度

---

### 11.2 2026-02-02 v1.0リリーススコープ決定

**確定事項:**

1. **高優先度バグ3件: 修正完了を確認**
   - BUG-01（おまかせ構成の空検索エラー）→ ✅ Phase 6-B で修正済み
   - BUG-03（ハンバーガーメニュー無反応）→ ✅ Phase 6-B で修正済み
   - OG画像が表示されない → ✅ Phase 6-E で修正済み

2. **中優先度機能: v1.0に含める**
   - sign_out エンドポイント追加
   - セキュリティ強化（ログイン試行制限、レート制限、CSP）
   - UX改善（CPU→マザボ絞り込み等）← ✅ Phase 6-C で実装済み

3. **v1.0リリーススコープ**
   - E2Eテスト（Playwright）の実装
   - ドキュメント整備（README等）
   - 上記完了後にv1.0としてリリース

---

## 12. 改訂履歴

| 日付 | 内容 |
|------|------|
| 2026-01-29 | 初版作成 |
| 2026-01-29 | Phase 5完了に伴い現状サマリー・管理者画面セクションを更新 |
| 2026-01-30 | Phase 6: 自動推奨パーツ機能修正（BUG-02解決）、APIシリアライザ修正 |
| 2026-01-31 | Phase 6 キックオフ: 意思決定記録追加、BUG-03追加、SPEC-01修正完了、バグ認識の訂正 |
| 2026-02-01 | Phase 6 調査結果反映: API検証チェックボックス埋め（認証3/4、パーツ3/3、プリセット2/2、構成6/6、管理者8/8）、セキュリティ項目更新、課題一覧整理 |
| 2026-02-07 | v1.0仕上げ: Phase 6実装済み項目のチェック一括更新（sign_out/セキュリティ/UX/A11y/バグ修正/シード/E2E）、API活用ビジョン記録、課題一覧ステータス更新 |
| 2026-02-09 | Phase 8.5完了反映: Amazon PA-API見送り理由追記、楽天API実装済みステータス更新、ダークモード（Phase 9）完了記録 |
